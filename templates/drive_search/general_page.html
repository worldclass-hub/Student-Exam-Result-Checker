<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMILIA FOREMOST HIGH SCHOOL | Student Result Portal</title>
    
    <!-- Django Static Loader -->
    {% load static %}
    
    <!-- Favicon - Emilia Logo -->
    <link rel="icon" type="image/x-icon" href="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* FIXED: Prevent overscroll bounce effect */
        html {
            overflow-x: hidden;
            max-width: 100%;
            position: relative;
            overscroll-behavior: none;
            height: 100%;
            scroll-behavior: smooth;
        }
        
        body {
            background: #f9fafb;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            max-width: 100%;
            width: 100%;
            overscroll-behavior-y: none;
        }
        
        /* ========== WORLD-CLASS ADMIN FLOATING BUTTON ========== */
        /* Super powerful design - Only for admin users */
        .admin-float-btn-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100000;
            display: none; /* Hidden by default, shown via JavaScript */
        }
        
        .admin-float-btn {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(109, 40, 217, 0.5);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .admin-float-btn:hover {
            transform: scale(1.15) rotate(8deg);
            box-shadow: 0 15px 40px rgba(109, 40, 217, 0.8);
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
        }
        
        .admin-float-btn:active {
            transform: scale(0.95);
        }
        
        .admin-float-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .admin-float-btn:hover::before {
            opacity: 1;
        }
        
        .admin-float-btn::after {
            content: 'ADMIN PANEL';
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 1px;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-float-btn:hover::after {
            opacity: 1;
            bottom: -45px;
        }
        
        /* Admin button glow animation */
        @keyframes admin-glow {
            0%, 100% {
                box-shadow: 0 0 25px rgba(109, 40, 217, 0.6);
            }
            50% {
                box-shadow: 0 0 40px rgba(109, 40, 217, 0.9), 0 0 60px rgba(109, 40, 217, 0.4);
            }
        }
        
        .admin-float-btn.glow {
            animation: admin-glow 2s infinite;
        }
        
        /* Admin button tooltip expanded */
        .admin-tooltip {
            position: absolute;
            right: 85px;
            bottom: 10px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 18px 22px;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 600;
            max-width: 280px;
            width: max-content;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            z-index: 100001;
        }
        
        .admin-tooltip::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 8px solid rgba(0, 0, 0, 0.95);
        }
        
        .admin-float-btn-container:hover .admin-tooltip {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Admin button pulse effect */
        .admin-pulse {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(109, 40, 217, 0.4);
            animation: admin-pulse 2s infinite;
            z-index: -1;
        }
        
        @keyframes admin-pulse {
            0% {
                transform: scale(0.8);
                opacity: 0.8;
            }
            70% {
                transform: scale(1.6);
                opacity: 0;
            }
            100% {
                transform: scale(1.6);
                opacity: 0;
            }
        }
        
        /* Admin context menu */
        .admin-context-menu {
            position: fixed;
            background: rgba(0, 0, 0, 0.98);
            color: white;
            border-radius: 16px;
            padding: 8px 0;
            min-width: 220px;
            z-index: 100002;
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.7);
            opacity: 0;
            transform: scale(0.95);
            transform-origin: bottom right;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .admin-context-menu.active {
            opacity: 1;
            transform: scale(1);
        }
        
        .admin-context-header {
            padding: 12px 16px;
            font-size: 11px;
            opacity: 0.7;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .admin-context-item {
            padding: 14px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
            font-size: 14px;
        }
        
        .admin-context-item:hover {
            background: rgba(109, 40, 217, 0.3);
        }
        
        .admin-context-item i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }
        
        /* Mobile responsive admin button */
        @media (max-width: 768px) {
            .admin-float-btn-container {
                bottom: 20px;
                right: 20px;
            }
            
            .admin-float-btn {
                width: 60px;
                height: 60px;
                font-size: 22px;
            }
            
            .admin-tooltip {
                right: 75px;
                bottom: 5px;
                font-size: 13px;
                padding: 15px 18px;
                max-width: 240px;
            }
            
            .admin-float-btn::after {
                font-size: 11px;
                padding: 6px 12px;
                bottom: -38px;
            }
            
            .admin-context-menu {
                min-width: 200px;
                right: 20px !important;
                bottom: 85px !important;
            }
        }
        
        @media (max-width: 480px) {
            .admin-tooltip {
                display: none; /* Hide tooltip on very small screens */
            }
        }
        /* ========== END ADMIN FLOATING BUTTON ========== */
        
        /* Django Messages Styling */
        .django-messages {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 99999;
            max-width: 400px;
            width: 100%;
        }
        
        .django-message {
            padding: 16px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideInRight 0.3s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .message-success {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .message-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .message-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .message-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .message-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .message-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .message-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .message-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Main container - FIXED: Proper scroll containment */
        .page-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Content wrapper - FIXED: Proper scroll management */
        .content-wrapper {
            flex: 1 0 auto;
            width: 100%;
            max-width: 100%;
            position: relative;
        }
        
        /* Footer - FIXED: Stays at bottom */
        .page-footer {
            flex-shrink: 0;
            width: 100%;
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        /* FIXED: Scroll boundary indicator */
        .scroll-boundary {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #1a237e, #1b5e20);
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .scroll-boundary.visible {
            opacity: 1;
        }
        
        /* Modal overlay fix */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 50;
            background: rgba(0, 0, 0, 0.8);
        }
        
        /* Prevent overscroll on mobile */
        @media (max-width: 768px) {
            body {
                overscroll-behavior-y: contain;
            }
            
            .django-messages {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }
        
        /* Original Styles */
        .title-font {
            font-family: 'Playfair Display', serif;
        }
        .school-primary {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        }
        .school-green {
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
        }
        .school-yellow {
            background: linear-gradient(135deg, #f57f17 0%, #ffb300 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        .logo-badge {
            background: linear-gradient(135deg, #1a237e, #1b5e20);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            display: inline-block;
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .gradient-border {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #1a237e, #1b5e20) border-box;
        }
        .header-gradient {
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.95) 0%, rgba(27, 94, 32, 0.95) 100%);
            backdrop-filter: blur(10px);
        }
        .subject-row:hover {
            background-color: #f0f7ff;
            transform: translateX(5px);
            transition: all 0.3s ease;
        }
        .stats-bg {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.95) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        /* Super Powerful Button Styles */
        .action-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            border: 2px solid transparent;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .action-btn:active {
            transform: translateY(-1px);
            transition: all 0.1s ease;
        }
        
        .action-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .action-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .btn-icon {
            transition: transform 0.3s ease;
        }
        
        .action-btn:hover .btn-icon {
            transform: scale(1.1);
        }
        
        /* Responsive button container */
        .btn-container {
            display: grid;
            gap: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .btn-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 639px) {
            .btn-container {
                grid-template-columns: 1fr;
            }
            
            .action-btn {
                padding-top: 0.875rem;
                padding-bottom: 0.875rem;
                font-size: 0.95rem;
            }
        }
        
        @media (min-width: 640px) {
            .action-btn {
                padding-top: 0.875rem;
                padding-bottom: 0.875rem;
            }
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 640px) {
            .mobile-stack {
                flex-direction: column !important;
                text-align: center;
            }
            .mobile-center {
                justify-content: center !important;
            }
            .mobile-full {
                width: 100% !important;
            }
            .mobile-mt-4 {
                margin-top: 1rem !important;
            }
        }
        
        /* FIXED: Better scroll management */
        .scroll-container {
            position: relative;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* FIXED: Prevent pull-to-refresh */
        body {
            overscroll-behavior-y: contain;
        }
        
        /* FIXED: Smooth scrolling boundaries */
        html {
            scroll-behavior: smooth;
        }
        
        /* FIXED: Prevent content overflow */
        main {
            overflow-x: hidden;
            width: 100%;
        }
        
        /* FIXED: Ensure footer stays at bottom */
        .footer-wrapper {
            margin-top: auto;
        }
        
        /* Session dropdown styling */
        .session-option {
            font-weight: 500;
        }
        .session-option.current {
            color: #059669;
            font-weight: bold;
        }
        .session-option.future {
            color: #2563eb;
        }
        .session-option.past {
            color: #6b7280;
        }
        
        /* PDF File Results Styling */
        .pdf-result-item {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .pdf-result-item:hover {
            background-color: #f9fafb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .pdf-result-badge {
            background-color: #dbeafe;
            color: #1e40af;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }
        
        .pdf-file-info {
            font-size: 0.875rem;
            color: #6b7280;
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .pdf-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pdf-view-btn {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .pdf-view-btn:hover {
            background-color: #bfdbfe;
        }
        
        .pdf-download-btn {
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
            color: white;
        }
        
        .pdf-download-btn:hover {
            background: linear-gradient(135deg, #166b1a 0%, #256628 100%);
        }
        
        /* Loading spinner */
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Search results styling */
        .success-alert {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .error-alert {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 1px solid #ef4444;
            color: #7f1d1d;
        }
        
        /* Form field styling */
        .form-input {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-select {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Professional Logout Button Styles - UPDATED FOR DJANGO */
        .logout-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px rgba(220, 38, 38, 0.25);
            position: relative;
            overflow: hidden;
            z-index: 10;
        }
        
        .logout-btn:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(220, 38, 38, 0.3);
        }
        
        .logout-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.25);
        }
        
        .logout-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }
        
        .logout-btn:hover::before {
            left: 100%;
        }
        
        .logout-btn i {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        
        .logout-btn:hover i {
            transform: translateX(2px);
        }
        
        @media (max-width: 768px) {
            .logout-btn {
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
            }
            
            .logout-btn span {
                display: none;
            }
            
            .logout-btn i {
                font-size: 1rem;
                margin: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ========== SUPER POWERFUL ADMIN FLOATING BUTTON ========== -->
    <!-- This button only appears for admin users -->
    <div class="admin-float-btn-container" id="adminFloatBtnContainer">
        <div class="admin-pulse"></div>
        <button class="admin-float-btn glow" id="adminFloatBtn" title="Admin Panel Access">
            <i class="fas fa-crown"></i>
        </button>
        <div class="admin-tooltip">
            <strong>Admin Panel Access</strong><br>
            Quick access to Django Admin for system management, user control, and database administration.
        </div>
    </div>
    
    <!-- Scroll Boundary Indicator -->
    <div id="scrollBoundary" class="scroll-boundary"></div>
    
    <!-- Django Messages Display -->
    {% if messages %}
    <div class="django-messages">
        {% for message in messages %}
        <div class="django-message message-{{ message.tags }}">
            <div class="message-content">
                <div class="message-icon">
                    {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle"></i>
                    {% elif message.tags == 'error' %}
                    <i class="fas fa-exclamation-circle"></i>
                    {% elif message.tags == 'warning' %}
                    <i class="fas fa-exclamation-triangle"></i>
                    {% else %}
                    <i class="fas fa-info-circle"></i>
                    {% endif %}
                </div>
                <div class="message-text">
                    {{ message }}
                </div>
            </div>
            <button class="message-close" onclick="this.parentElement.style.animation='slideOutRight 0.3s ease-out forwards'; setTimeout(() => this.parentElement.remove(), 300)">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="page-container" id="pageContainer">
        <!-- Yellow Notice Bar - Fixed to sit properly with navbar -->
        <div class="school-yellow text-gray-900 py-2 px-4 text-center font-medium w-full">
            <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-center gap-2">
                <span class="flex items-center">
                    <i class="fas fa-star mr-2"></i> 
                    <span class="hidden sm:inline">Student Results Portal - All Terms Available</span>
                    <span class="sm:hidden">Results Available</span>
                </span>
                <span class="hidden sm:inline">|</span>
                <span class="font-bold">Official School Results</span>
            </div>
        </div>

        <!-- Main Header -->
        <header class="header-gradient text-white py-4 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <!-- School Logo & Name -->
                    <div class="flex items-center mb-4 md:mb-0 mobile-center">
                        <div class="mr-4">
                            <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                 alt="Emilia Foremost High School Logo"
                                 class="w-16 h-16 object-contain bg-white p-2 rounded-xl shadow-lg">
                        </div>
                        <div class="text-center md:text-left">
                            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold title-font leading-tight">EMILIA FOREMOST HIGH SCHOOL</h1>
                            <p class="text-blue-100 text-xs sm:text-sm md:text-base">Academic Excellence & Character Development Since 2007</p>
                        </div>
                    </div>

                    <!-- School Motto & Logout Button -->
                    <div class="flex items-center gap-4 mobile-mt-4">
                        <!-- School Motto -->
                        <div class="text-center md:text-right">
                            <div class="logo-badge">
                                <i class="fas fa-graduation-cap mr-2"></i>
                                EMIFORPHS
                            </div>
                            <p class="text-sm text-gray-200 mt-1 hidden sm:block">Knowledge • Integrity • Excellence</p>
                        </div>
                        
                        <!-- Professional Logout Button - UPDATED FOR DJANGO -->
                        <button id="logoutBtn" class="logout-btn" data-logout-url="{% url 'logout' %}">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="content-wrapper max-w-7xl mx-auto px-4 py-8">
            <!-- Page Title -->
            <div class="text-center mb-10">
                <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 mb-3">Student Result Portal</h2>
                <p class="text-gray-600 text-base sm:text-lg max-w-3xl mx-auto">
                    Enter student details below to access official academic results for JSS 1 - SS 3
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Column - Result Checker -->
                <div class="bg-white rounded-2xl card-shadow overflow-hidden gradient-border">
                    <!-- Form Header -->
                    <div class="school-primary text-white p-6">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-search text-blue-900 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-xl font-bold">Check Student Result</h3>
                                <p class="text-blue-100 text-sm">Enter accurate student information</p>
                            </div>
                        </div>
                    </div>

                    <!-- Result Form -->
                    <div class="p-4 sm:p-6 md:p-8">
                        <!-- Django CSRF Token for AJAX -->
                        {% csrf_token %}
                        
                        <form id="resultForm">
                            <!-- Full Name - EMPTY -->
                            <div class="mb-6">
                                <label class="block text-gray-700 font-semibold mb-2">
                                    <i class="fas fa-user-circle text-blue-600 mr-2"></i>
                                    Student's Full Name
                                </label>
                                <input type="text" id="fullName" 
                                    class="form-input"
                                    placeholder="Enter student's complete name as registered"
                                    required>
                                <p class="text-xs sm:text-sm text-gray-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Enter first name, middle name, and surname exactly as in school records
                                </p>
                            </div>

                            <!-- Class Selection - EMPTY -->
                            <div class="mb-6">
                                <label class="block text-gray-700 font-semibold mb-2">
                                    <i class="fas fa-school text-blue-600 mr-2"></i>
                                    Class
                                </label>
                                <select id="studentClass" class="form-select" required>
                                    <option value="">Select Class</option>
                                    <option value="JSS1">JSS 1</option>
                                    <option value="JSS2">JSS 2</option>
                                    <option value="JSS3">JSS 3</option>
                                    <option value="SS1">SS 1</option>
                                    <option value="SS2">SS 2</option>
                                    <option value="SS3">SS 3</option>
                                </select>
                            </div>

                            <!-- Term & Session - EMPTY -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-8">
                                <div>
                                    <label class="block text-gray-700 font-semibold mb-2">
                                        <i class="fas fa-calendar-alt text-blue-600 mr-2"></i>
                                        Term
                                    </label>
                                    <select id="term" class="form-select" required>
                                        <option value="">Select Term</option>
                                        <option value="1">First Term</option>
                                        <option value="2">Second Term</option>
                                        <option value="3">Third Term</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-semibold mb-2">
                                        <i class="fas fa-calendar text-blue-600 mr-2"></i>
                                        Academic Session
                                    </label>
                                    <select id="session" class="form-select" required>
                                        <option value="">Loading sessions...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" id="checkResultBtn" 
                                class="w-full school-green text-white font-bold py-3 sm:py-4 rounded-lg hover:opacity-90 transition duration-300 text-base sm:text-lg flex items-center justify-center shadow-lg">
                                <i class="fas fa-file-alt mr-2 sm:mr-3"></i> 
                                CHECK STUDENT RESULT
                            </button>

                            <div class="mt-6 pt-6 border-t border-gray-200">
                                <div class="flex flex-wrap justify-center gap-4 sm:gap-6">
                                    <div class="flex items-center">
                                        <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                             alt="Emilia Logo"
                                             class="w-6 h-6 sm:w-8 sm:h-8 mr-2">
                                        <span class="text-gray-700 font-semibold text-sm sm:text-base">Official School Portal</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-shield-alt text-green-600 text-lg sm:text-xl mr-2"></i>
                                        <span class="text-gray-600 text-sm sm:text-base">Secure & Verified</span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Right Column - Results Display -->
                <div>
                    <!-- Instructions / Welcome -->
                    <div id="welcomePanel" class="bg-white rounded-2xl card-shadow p-6 sm:p-8 mb-8">
                        <div class="text-center">
                            <div class="floating mb-6">
                                <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                     alt="Emilia Logo"
                                     class="w-20 h-20 sm:w-24 sm:h-24 mx-auto">
                            </div>
                            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Welcome to EMIFORPHS Result Portal</h3>
                            <p class="text-gray-600 mb-6 text-sm sm:text-base">
                                Enter student details on the left to access official academic results. 
                                This portal provides instant access to results for all classes from JSS 1 to SS 3.
                            </p>
                            
                            <!-- Quick Stats - Updated with responsive background -->
                            <div class="grid grid-cols-3 gap-3 sm:gap-4 mb-8">
                                <div class="text-center p-3 sm:p-4 rounded-xl stats-bg">
                                    <div class="text-xl sm:text-2xl font-bold text-blue-700">1,200+</div>
                                    <div class="text-xs sm:text-sm text-gray-600 mt-1">Students</div>
                                </div>
                                <div class="text-center p-3 sm:p-4 rounded-xl stats-bg">
                                    <div class="text-xl sm:text-2xl font-bold text-green-700">100%</div>
                                    <div class="text-xs sm:text-sm text-gray-600 mt-1">Result Accuracy</div>
                                </div>
                                <div class="text-center p-3 sm:p-4 rounded-xl stats-bg">
                                    <div class="text-xl sm:text-2xl font-bold text-purple-700">24/7</div>
                                    <div class="text-xs sm:text-sm text-gray-600 mt-1">Access</div>
                                </div>
                            </div>

                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center text-sm sm:text-base">
                                    <i class="fas fa-lightbulb text-yellow-600 mr-2"></i>
                                    Need Help?
                                </h4>
                                <p class="text-gray-700 text-xs sm:text-sm">
                                    If you encounter any issues or need assistance, contact the school office at 
                                    <strong>0905-714-749</strong> or email 
                                    <strong>emiliaforemost@gmail.com</strong>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- PDF File Results Display -->
                    <div id="pdfResultsContainer" class="hidden bg-white rounded-2xl card-shadow overflow-hidden mb-8">
                        <!-- Results Header -->
                        <div class="school-primary text-white p-4 sm:p-6">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                                <div class="mb-4 sm:mb-0">
                                    <h3 class="text-xl sm:text-2xl font-bold">SEARCH RESULTS</h3>
                                    <div class="flex items-center mt-2">
                                        <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                             alt="Emilia Logo"
                                             class="w-8 h-8 sm:w-10 sm:h-10 mr-3 bg-white p-1 rounded">
                                        <div>
                                            <div id="searchStudentName" class="text-base sm:text-lg font-semibold">-</div>
                                            <div id="searchClassInfo" class="text-blue-100 text-xs sm:text-sm">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-left sm:text-right">
                                    <button onclick="hidePDFResults()" class="text-white hover:text-gray-300">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                    <div class="mt-2 text-xs sm:text-sm">
                                        <i class="fas fa-calendar mr-1"></i>
                                        <span id="searchTermSession">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Results Content -->
                        <div class="p-4 sm:p-6">
                            <div id="pdfResultsContent">
                                <!-- PDF files will appear here -->
                            </div>
                        </div>

                        <!-- Verification Footer -->
                        <div class="bg-gray-900 text-white p-3 sm:p-4 text-center">
                            <div class="flex items-center justify-center">
                                <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                     alt="Emilia Logo"
                                     class="w-6 h-6 sm:w-8 sm:h-8 mr-2 sm:mr-3 bg-white p-1 rounded">
                                <div>
                                    <div class="font-medium text-sm sm:text-base">OFFICIAL RESULT FILES</div>
                                    <div class="text-gray-400 text-xs sm:text-sm">© EMILIA FOREMOST HIGH SCHOOL • Authorized Use Only</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Announcements -->
                    <div class="bg-white rounded-2xl card-shadow p-4 sm:p-6 mt-6 sm:mt-8">
                        <h4 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center">
                            <i class="fas fa-bullhorn text-red-600 mr-2 sm:mr-3"></i>
                            School Announcements
                        </h4>
                        <div class="space-y-3 sm:space-y-4">
                            <div class="flex items-start border-l-4 border-blue-500 pl-3 sm:pl-4 py-2">
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm sm:text-base">All Results Available</p>
                                    <p class="text-gray-600 text-xs sm:text-sm">Results for all terms and sessions are accessible through this portal.</p>
                                </div>
                            </div>
                            <div class="flex items-start border-l-4 border-green-500 pl-3 sm:pl-4 py-2">
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm sm:text-base">New Academic Session</p>
                                    <p class="text-gray-600 text-xs sm:text-sm">2025/2026 session begins September 2025.</p>
                                </div>
                            </div>
                            <div class="flex items-start border-l-4 border-yellow-500 pl-3 sm:pl-4 py-2">
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm sm:text-base">Result Verification</p>
                                    <p class="text-gray-600 text-xs sm:text-sm">Report any discrepancies to the school office immediately.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="page-footer bg-gray-900 text-white mt-8 sm:mt-12 footer-wrapper">
            <div class="max-w-7xl mx-auto px-4 py-6 sm:py-8">
                <div class="flex flex-col md:flex-row justify-between items-center mobile-stack">
                    <!-- School Info - Updated with white background logo -->
                    <div class="mb-6 md:mb-0 text-center md:text-left">
                        <div class="flex items-center justify-center md:justify-start mb-3 sm:mb-4">
                            <!-- White background added to logo -->
                            <div class="bg-white p-1 rounded-lg mr-3 sm:mr-4">
                                <img src="https://ncctazjcffmpuniwctkz.supabase.co/storage/v1/object/public/user-uploads/EMILIA%20LOGO.png" 
                                     alt="Emilia Logo"
                                     class="w-10 h-10 sm:w-12 sm:h-12 object-contain">
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-xl font-bold">EMILIA FOREMOST HIGH SCHOOL</h3>
                                <p class="text-gray-400 text-xs sm:text-sm">EMIFORPHS • Excellence in Education</p>
                            </div>
                        </div>
                        <p class="text-gray-400 text-xs sm:text-sm max-w-md">
                            Providing quality secondary education since 2007. 
                            Committed to academic excellence and moral development.
                        </p>
                    </div>

                    <!-- Contact -->
                    <div class="text-center md:text-right mobile-mt-4">
                        <h4 class="font-bold mb-2 sm:mb-4 text-sm sm:text-base">Contact Information</h4>
                        <div class="space-y-1 sm:space-y-2">
                            <p class="text-gray-400 text-xs sm:text-sm">
                                <i class="fas fa-map-marker-alt mr-2"></i>
                                2, Olasupo Avenue, Off Adeyemi Street, Oke-Agbo, Ojo, Lagos
                            </p>
                            <p class="text-gray-400 text-xs sm:text-sm">
                                <i class="fas fa-phone mr-2"></i>
                                0905-714-749, 0802-285-4677
                            </p>
                            <p class="text-gray-400 text-xs sm:text-sm">
                                <i class="fas fa-envelope mr-2"></i>
                                emiliaforemost@gmail.com
                            </p>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-800 mt-6 sm:mt-8 pt-6 sm:pt-8 text-center">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <p class="text-gray-500 text-xs sm:text-sm">
                            &copy; 2024 EMILIA FOREMOST HIGH SCHOOL. All Rights Reserved.
                        </p>
                        <div class="mt-2 md:mt-0">
                            <span class="text-gray-500 text-xs sm:text-sm">
                                <i class="fas fa-lock mr-1"></i>
                                Secure Student Result Portal v2.0
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // ==================== ADMIN FLOATING BUTTON SYSTEM ====================
        function setupAdminFloatingButton() {
            const adminFloatBtnContainer = document.getElementById('adminFloatBtnContainer');
            const adminFloatBtn = document.getElementById('adminFloatBtn');
            
            // Check if user is admin using Django template variable
            // You should adjust this based on your Django implementation
            {% comment %}
            // In your Django view, add:
            // context['is_admin'] = request.user.is_staff or request.user.is_superuser
            // Then in template: {% if is_admin %}show button{% endif %}
            {% endcomment %}
            
            // For this template, we'll check for staff/superuser status
            const isAdminUser = {% if user.is_authenticated and user.is_staff %}true{% else %}false{% endif %};
            
            // Also check for specific admin usernames if needed
            const currentUsername = "{{ user.username|default:'' }}";
            const isAdminByUsername = currentUsername.includes('admin') || 
                                     currentUsername.includes('Admin') || 
                                     currentUsername.includes('ADMIN');
            
            // Show button if user is admin (staff/superuser or has admin in username)
            if (isAdminUser || isAdminByUsername) {
                if (adminFloatBtnContainer) {
                    adminFloatBtnContainer.style.display = 'block';
                    
                    // Add click event to redirect to Django admin
                    if (adminFloatBtn) {
                        adminFloatBtn.addEventListener('click', function(e) {
                            // If right-click, show context menu instead
                            if (e.button === 2 || (e.type === 'contextmenu')) {
                                e.preventDefault();
                                showAdminContextMenu(e);
                                return;
                            }
                            
                            // Left click - go to admin panel
                            window.location.href = '/admin/';
                        });
                        
                        // Add right-click context menu for extra admin options
                        adminFloatBtn.addEventListener('contextmenu', function(e) {
                            e.preventDefault();
                            showAdminContextMenu(e);
                        });
                        
                        // Touch devices - long press for context menu
                        let touchTimer;
                        adminFloatBtn.addEventListener('touchstart', function(e) {
                            touchTimer = setTimeout(function() {
                                showAdminContextMenu(e.touches[0] || e);
                            }, 800); // 800ms long press
                        });
                        
                        adminFloatBtn.addEventListener('touchend', function() {
                            clearTimeout(touchTimer);
                        });
                    }
                }
            }
            
            // Remove any existing context menu when clicking elsewhere
            document.addEventListener('click', function(e) {
                const contextMenu = document.querySelector('.admin-context-menu');
                if (contextMenu && !contextMenu.contains(e.target) && !adminFloatBtn.contains(e.target)) {
                    contextMenu.remove();
                }
            });
            
            // Also remove on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const contextMenu = document.querySelector('.admin-context-menu');
                    if (contextMenu) contextMenu.remove();
                }
            });
            
            // For testing: Uncomment to always show the button
            // if (adminFloatBtnContainer) adminFloatBtnContainer.style.display = 'block';
        }
        
        function showAdminContextMenu(e) {
            // Remove existing context menu
            const existingMenu = document.querySelector('.admin-context-menu');
            if (existingMenu) existingMenu.remove();
            
            // Calculate position
            const x = e.clientX || e.pageX;
            const y = e.clientY || e.pageY;
            
            // Create context menu
            const contextMenu = document.createElement('div');
            contextMenu.className = 'admin-context-menu';
            contextMenu.style.right = `${window.innerWidth - x}px`;
            contextMenu.style.bottom = `${window.innerHeight - y}px`;
            
            contextMenu.innerHTML = `
                <div class="admin-context-header">Admin Quick Actions</div>
                <div class="admin-context-item" data-action="admin-panel">
                    <i class="fas fa-cogs"></i>
                    <span>Django Admin Panel</span>
                </div>
                <div class="admin-context-item" data-action="user-management">
                    <i class="fas fa-users-cog"></i>
                    <span>User Management</span>
                </div>
                <div class="admin-context-item" data-action="database">
                    <i class="fas fa-database"></i>
                    <span>Database Tools</span>
                </div>
                <div class="admin-context-item" data-action="site-settings">
                    <i class="fas fa-sliders-h"></i>
                    <span>Site Settings</span>
                </div>
                <div class="admin-context-item" data-action="result-management">
                    <i class="fas fa-file-alt"></i>
                    <span>Result Management</span>
                </div>
                <div class="admin-context-item" data-action="logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>System Logs</span>
                </div>
                <div class="admin-context-item" data-action="backup">
                    <i class="fas fa-download"></i>
                    <span>Backup System</span>
                </div>
            `;
            
            document.body.appendChild(contextMenu);
            
            // Animate in
            setTimeout(() => {
                contextMenu.classList.add('active');
            }, 10);
            
            // Add click handlers
            const items = contextMenu.querySelectorAll('.admin-context-item');
            items.forEach(item => {
                item.addEventListener('click', () => {
                    const action = item.getAttribute('data-action');
                    handleAdminContextAction(action);
                    contextMenu.remove();
                });
            });
        }
        
        function handleAdminContextAction(action) {
            const baseUrl = '/admin';
            const actionUrls = {
                'admin-panel': baseUrl + '/',
                'user-management': baseUrl + '/auth/user/',
                'database': baseUrl + '/admin-tools/',
                'site-settings': baseUrl + '/config/sites/',
                'result-management': baseUrl + '/results/',
                'logs': baseUrl + '/logentry/',
                'backup': baseUrl + '/backup/'
            };
            
            // Show loading on admin button
            const adminBtn = document.getElementById('adminFloatBtn');
            if (adminBtn) {
                const originalIcon = adminBtn.innerHTML;
                adminBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                // Reset icon after 2 seconds
                setTimeout(() => {
                    adminBtn.innerHTML = originalIcon;
                }, 2000);
            }
            
            // Navigate to URL
            if (actionUrls[action]) {
                window.location.href = actionUrls[action];
            } else {
                window.location.href = baseUrl + '/';
            }
        }
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Load available sessions
            loadAvailableSessions();
            
            // Setup scroll management
            setupScrollManagement();
            
            // Add ripple effect to buttons
            setupRippleEffect();
            
            // Setup Django logout button functionality
            setupDjangoLogoutButton();
            
            // Setup admin floating button
            setupAdminFloatingButton();
            
            // Auto-remove Django messages after 5 seconds
            autoRemoveMessages();
            
            // Add keyboard shortcut for admin panel (Ctrl+Shift+A)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    const adminBtn = document.getElementById('adminFloatBtn');
                    if (adminBtn) adminBtn.click();
                }
            });
        });

        // ==================== DJANGO LOGOUT FUNCTIONALITY ====================
        function setupDjangoLogoutButton() {
            const logoutBtn = document.getElementById('logoutBtn');
            const csrfToken = getCsrfToken();
            const logoutUrl = logoutBtn.getAttribute('data-logout-url') || '/logout/';
            
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Show confirmation dialog
                if (confirm('Are you sure you want to logout from the Result Portal?')) {
                    // Show loading state
                    const originalHTML = logoutBtn.innerHTML;
                    logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Logging out...</span>';
                    logoutBtn.disabled = true;
                    
                    // Create a form to submit logout request
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = logoutUrl;
                    form.style.display = 'none';
                    
                    // Add CSRF token
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrfmiddlewaretoken';
                    csrfInput.value = csrfToken;
                    form.appendChild(csrfInput);
                    
                    // Add to body and submit
                    document.body.appendChild(form);
                    form.submit();
                }
            });
            
            // Add keyboard shortcut (Alt + L) for logout
            document.addEventListener('keydown', function(e) {
                if (e.altKey && e.key === 'l') {
                    e.preventDefault();
                    logoutBtn.click();
                }
            });
            
            // Add session timeout warning (optional)
            setupSessionTimeoutWarning();
        }
        
        // ==================== SESSION TIMEOUT WARNING ====================
        function setupSessionTimeoutWarning() {
            let timeoutWarningShown = false;
            let logoutTimeout;
            
            // Reset timer on user activity
            function resetLogoutTimer() {
                if (logoutTimeout) {
                    clearTimeout(logoutTimeout);
                }
                
                // Set timeout for 30 minutes (1800000 ms)
                logoutTimeout = setTimeout(function() {
                    if (!timeoutWarningShown) {
                        timeoutWarningShown = true;
                        showSessionTimeoutWarning();
                    }
                }, 1800000); // 30 minutes
            }
            
            // Show session timeout warning
            function showSessionTimeoutWarning() {
                if (confirm('Your session will expire in 5 minutes due to inactivity. Click OK to stay logged in.')) {
                    // Reset the timer if user confirms
                    timeoutWarningShown = false;
                    resetLogoutTimer();
                } else {
                    // Logout after 5 minutes if no response
                    setTimeout(function() {
                        document.getElementById('logoutBtn').click();
                    }, 300000); // 5 minutes
                }
            }
            
            // Listen for user activity
            document.addEventListener('mousemove', resetLogoutTimer);
            document.addEventListener('keypress', resetLogoutTimer);
            document.addEventListener('click', resetLogoutTimer);
            document.addEventListener('scroll', resetLogoutTimer);
            
            // Start the timer
            resetLogoutTimer();
        }

        // ==================== DJANGO MESSAGES ====================
        function autoRemoveMessages() {
            setTimeout(() => {
                const messages = document.querySelectorAll('.django-message');
                messages.forEach(message => {
                    message.style.animation = 'slideOutRight 0.3s ease-out forwards';
                    setTimeout(() => message.remove(), 300);
                });
            }, 5000);
        }

        // Function to show Django-style message
        function showDjangoMessage(message, type = 'success') {
            const messagesContainer = document.querySelector('.django-messages');
            if (!messagesContainer) {
                // Create messages container if it doesn't exist
                const newContainer = document.createElement('div');
                newContainer.className = 'django-messages';
                document.body.appendChild(newContainer);
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `django-message message-${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            else if (type === 'error') icon = 'fas fa-exclamation-circle';
            else if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="message-text">
                        ${message}
                    </div>
                </div>
                <button class="message-close" onclick="this.parentElement.style.animation='slideOutRight 0.3s ease-out forwards'; setTimeout(() => this.parentElement.remove(), 300)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            const container = document.querySelector('.django-messages');
            container.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'slideOutRight 0.3s ease-out forwards';
                setTimeout(() => messageDiv.remove(), 300);
            }, 5000);
        }

        // ==================== SIMPLE DOWNLOAD FUNCTION ====================
        function startFileDownload(fileId, fileName) {
            // Simple download without any monitoring
            const link = document.createElement('a');
            link.href = `/download/?file_id=${fileId}`;
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Preview PDF file
        function previewPDF(fileId) {
            window.open(`https://drive.google.com/file/d/${fileId}/view`, '_blank');
        }

        // ==================== FORM FUNCTIONS ====================
        async function loadAvailableSessions() {
            try {
                const sessionSelect = document.getElementById('session');
                
                // Try to get sessions from backend
                const response = await fetch('/get_sessions/');
                const data = await response.json();
                
                sessionSelect.innerHTML = '';
                
                if (data.success && data.sessions && data.sessions.length > 0) {
                    // Use sessions from backend
                    populateSessionDropdown(data.sessions, true);
                } else {
                    // Generate sessions locally if backend fails
                    const generatedSessions = generateFutureSessions();
                    populateSessionDropdown(generatedSessions, false);
                }
                
            } catch (error) {
                console.log('Error loading sessions, generating locally');
                // Generate sessions locally if fetch fails
                const generatedSessions = generateFutureSessions();
                populateSessionDropdown(generatedSessions, false);
            }
        }

        function generateFutureSessions() {
            // Generate sessions from current year - 1 to 10 years in future
            const currentYear = new Date().getFullYear();
            const startYear = currentYear - 1; // Include previous year
            
            const sessions = [];
            
            // Generate sessions for next 10 years
            for (let year = startYear; year <= startYear + 10; year++) {
                sessions.push(`${year}/${year + 1}`);
            }
            
            return sessions;
        }

        function populateSessionDropdown(sessions, fromBackend) {
            const sessionSelect = document.getElementById('session');
            
            if (!sessions || sessions.length === 0) {
                sessionSelect.innerHTML = '<option value="">No sessions available</option>';
                return;
            }
            
            // Sort sessions (newest first)
            sessions.sort((a, b) => {
                const yearA = parseInt(a.split('/')[0]);
                const yearB = parseInt(b.split('/')[0]);
                return yearB - yearA;
            });
            
            // Get current academic year
            const now = new Date();
            const currentMonth = now.getMonth(); // 0 = January
            const currentYear = now.getFullYear();
            
            // Academic year typically starts in September
            let currentAcademicYearStart;
            if (currentMonth >= 8) { // September or later
                currentAcademicYearStart = currentYear;
            } else {
                currentAcademicYearStart = currentYear - 1;
            }
            const currentAcademicSession = `${currentAcademicYearStart}/${currentAcademicYearStart + 1}`;
            
            // Clear existing options except first one
            while (sessionSelect.options.length > 1) {
                sessionSelect.remove(1);
            }
            
            // Add each session as an option
            sessions.forEach(session => {
                const option = document.createElement('option');
                option.value = session;
                option.textContent = session;
                
                // Add CSS classes for styling
                if (session === currentAcademicSession) {
                    option.classList.add('current');
                    option.textContent += ' (Current)';
                } else {
                    const sessionYear = parseInt(session.split('/')[0]);
                    const currentYearInt = parseInt(currentAcademicSession.split('/')[0]);
                    
                    if (sessionYear > currentYearInt) {
                        option.classList.add('future');
                        option.textContent += ' (Upcoming)';
                    } else if (sessionYear < currentYearInt) {
                        option.classList.add('past');
                        option.textContent += ' (Past)';
                    }
                }
                
                sessionSelect.appendChild(option);
            });
            
            // Select the placeholder option
            sessionSelect.selectedIndex = 0;
            
            console.log(`✅ Loaded ${sessions.length} sessions ${fromBackend ? 'from server' : 'generated locally'}`);
        }

        // Form submission
        document.getElementById('resultForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            const term = document.getElementById('term').value;
            const session = document.getElementById('session').value;
            
            // Validation
            if (!fullName || !studentClass || !term || !session) {
                showAlert('Please fill in all required fields.', 'error');
                return;
            }
            
            // Validate that user selected something other than placeholder
            if (studentClass === "" || term === "" || session === "") {
                showAlert('Please select an option for all dropdown fields.', 'error');
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('checkResultBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> SEARCHING...';
            submitBtn.disabled = true;
            
            try {
                // Search for PDF files (this would call your backend API)
                const response = await fetch('/search/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCsrfToken()
                    },
                    body: JSON.stringify({
                        student_name: fullName,
                        student_class: studentClass,
                        term: term,
                        session: session
                    })
                });
                
                const data = await response.json();
                
                // Show PDF results
                showPDFResults(data, fullName, studentClass, term, session);
                
            } catch (error) {
                showAlert('Search failed. Please try again.', 'error');
                console.error('Search error:', error);
            } finally {
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Show PDF results
        function showPDFResults(data, fullName, studentClass, term, session) {
            const welcomePanel = document.getElementById('welcomePanel');
            const pdfResultsContainer = document.getElementById('pdfResultsContainer');
            const pdfResultsContent = document.getElementById('pdfResultsContent');
            
            // Update search info
            document.getElementById('searchStudentName').textContent = fullName;
            document.getElementById('searchClassInfo').textContent = studentClass;
            
            const termNames = {'1': 'First', '2': 'Second', '3': 'Third'};
            document.getElementById('searchTermSession').textContent = `${termNames[term] || term} Term • ${session}`;
            
            if (data.success && data.files && data.files.length > 0) {
                let filesHtml = '';
                
                data.files.forEach((file, index) => {
                    filesHtml += `
                        <div class="pdf-result-item">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="pdf-result-badge">File ${index + 1}</span>
                                        <span class="text-xs text-gray-500">
                                            <i class="fas fa-calendar-alt mr-1"></i>
                                            Term ${term} | ${session}
                                        </span>
                                    </div>
                                    <h4 class="font-bold text-gray-800 text-sm sm:text-base">${file.name}</h4>
                                    <div class="pdf-file-info">
                                        ${file.size_formatted ? `<span><i class="fas fa-weight mr-1"></i>${file.size_formatted}</span>` : ''}
                                        ${file.modifiedTime ? `<span><i class="far fa-clock mr-1"></i>${file.modifiedTime}</span>` : ''}
                                    </div>
                                </div>
                                <div class="flex gap-2 ml-4">
                                    <button onclick="previewPDF('${file.id}')" 
                                            class="pdf-action-btn pdf-view-btn">
                                        <i class="fas fa-eye"></i>
                                        <span class="hidden sm:inline">View</span>
                                    </button>
                                    <button onclick="startFileDownload('${file.id}', '${file.name}')" 
                                            class="pdf-action-btn pdf-download-btn">
                                        <i class="fas fa-download"></i>
                                        <span class="hidden sm:inline">Download</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                pdfResultsContent.innerHTML = `
                    <div class="success-alert p-4 rounded-lg mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-xl mr-3"></i>
                            <div>
                                <strong class="text-lg">Found ${data.count} result(s) for ${fullName}</strong>
                                <div class="text-sm mt-1">
                                    <span class="bg-green-200 px-2 py-1 rounded mr-2">${studentClass}</span>
                                    <span class="bg-yellow-100 px-2 py-1 rounded mr-2">${termNames[term] || term} Term</span>
                                    <span class="bg-blue-100 px-2 py-1 rounded">${session} Session</span>
                                </div>
                                <p class="mt-2">${data.message}</p>
                            </div>
                        </div>
                    </div>
                    ${filesHtml}
                `;
                
            } else {
                pdfResultsContent.innerHTML = `
                    <div class="error-alert p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle text-xl mr-3"></i>
                            <div>
                                <strong class="text-lg">No Results Found</strong>
                                <p class="mt-1">${data.message || 'Please check the details and try again'}</p>
                                <div class="mt-2 text-sm">
                                    <p>What to check:</p>
                                    <ul class="list-disc pl-5 mt-1">
                                        <li>Student name spelling (exactly as on result sheet)</li>
                                        <li>Correct class selection</li>
                                        <li>Correct term and session</li>
                                        <li>If name has multiple parts, try first name only</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Show results and hide welcome panel
            welcomePanel.classList.add('hidden');
            pdfResultsContainer.classList.remove('hidden');
            
            // Scroll to results
            pdfResultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Hide PDF results
        function hidePDFResults() {
            const welcomePanel = document.getElementById('welcomePanel');
            const pdfResultsContainer = document.getElementById('pdfResultsContainer');
            
            pdfResultsContainer.classList.add('hidden');
            welcomePanel.classList.remove('hidden');
            
            // Clear form - but keep selections if user wants to search again
            // Just reset the name field
            document.getElementById('fullName').value = '';
            document.getElementById('fullName').focus();
            
            // Scroll to form
            document.getElementById('fullName').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showAlert(message, type = 'info') {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `fixed top-20 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${
                type === 'error' ? 'bg-red-100 border-red-400 text-red-700' :
                type === 'success' ? 'bg-green-100 border-green-400 text-green-700' :
                'bg-blue-100 border-blue-400 text-blue-700'
            }`;
            alert.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(alert);
            
            // Remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function getCsrfToken() {
            // Try to get CSRF token from meta tag
            const metaTag = document.querySelector('meta[name="csrf-token"]');
            if (metaTag) {
                return metaTag.getAttribute('content');
            }
            
            // Try to get from form input
            const csrfInput = document.querySelector('input[name="csrfmiddlewaretoken"]');
            if (csrfInput) {
                return csrfInput.value;
            }
            
            // Try to get from cookies
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') return value;
            }
            
            return '';
        }

        // ==================== SCROLL MANAGEMENT ====================
        function setupScrollManagement() {
            let lastScrollTop = 0;
            let scrollTimeout;
            
            function checkScrollPosition() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight;
                const clientHeight = document.documentElement.clientHeight;
                
                // Check if we're at the bottom
                const distanceFromBottom = scrollHeight - (scrollTop + clientHeight);
                
                // Show boundary indicator when near bottom
                if (distanceFromBottom <= 50 && distanceFromBottom > 0) {
                    document.getElementById('scrollBoundary').classList.add('visible');
                } else {
                    document.getElementById('scrollBoundary').classList.remove('visible');
                }
                
                // Prevent overscroll beyond footer
                if (distanceFromBottom < 0) {
                    // We've scrolled past the bottom, bounce back
                    window.scrollTo({
                        top: scrollHeight - clientHeight,
                        behavior: 'smooth'
                    });
                }
                
                lastScrollTop = scrollTop;
            }
            
            function handleScroll() {
                if (scrollTimeout) {
                    window.cancelAnimationFrame(scrollTimeout);
                }
                
                scrollTimeout = window.requestAnimationFrame(checkScrollPosition);
            }
            
            window.addEventListener('scroll', handleScroll, { passive: true });
            checkScrollPosition();
        }

        // ==================== UI ENHANCEMENTS ====================
        function setupRippleEffect() {
            document.querySelectorAll('.action-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    // Create ripple element
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        border-radius: 50%;
                        background: rgba(255, 255, 255, 0.7);
                        transform: scale(0);
                        animation: ripple-animation 0.6s linear;
                        width: ${size}px;
                        height: ${size}px;
                        top: ${y}px;
                        left: ${x}px;
                        pointer-events: none;
                    `;
                    
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    
                    // Remove ripple after animation
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
            
            // Add CSS for ripple animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple-animation {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>